<!doctype html>
<html lang="zh-HK">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç«‹é«”åœ–å½¢é…å°å¤§æŒ‘æˆ°</title>

  <style>
    :root{
      --ink:#071020;
      --muted:#334155;
      --line: rgba(15,23,42,.12);
      --glass: rgba(255,255,255,.78);
      --glass2: rgba(255,255,255,.62);
      --shadow: 0 18px 45px rgba(2,6,23,.20);
      --cardShadow: 0 14px 30px rgba(2,6,23,.16);
      --blue:#2563eb;
      --purple:#7c3aed;
      --pink:#ec4899;
      --green:#22c55e;
      --amber:#f59e0b;
      --red:#ef4444;
      --cyan:#06b6d4;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:"Noto Sans TC","PingFang TC","Microsoft JhengHei",system-ui,sans-serif;
      color:var(--ink);
      min-height:100vh;
      overflow-x:hidden;
      background:
        radial-gradient(900px 520px at 8% 12%, rgba(59,130,246,.30), transparent 58%),
        radial-gradient(900px 520px at 92% 16%, rgba(236,72,153,.24), transparent 55%),
        radial-gradient(900px 520px at 35% 92%, rgba(34,197,94,.22), transparent 55%),
        radial-gradient(900px 520px at 70% 70%, rgba(245,158,11,.20), transparent 55%),
        linear-gradient(180deg, #f8fafc, #eef2ff);
    }

    .blob{
      position:fixed;
      width:320px; height:320px;
      border-radius:999px;
      filter: blur(35px);
      opacity:.55;
      z-index:-1;
      animation: float 9s ease-in-out infinite;
    }
    .b1{ left:-110px; top:90px; background: rgba(59,130,246,.55); }
    .b2{ right:-140px; top:140px; background: rgba(236,72,153,.50); animation-duration: 11s; }
    .b3{ left:25%; bottom:-160px; background: rgba(34,197,94,.45); animation-duration: 10.5s; }
    @keyframes float{
      0%,100%{ transform: translate(0,0) scale(1); }
      50%{ transform: translate(20px,-18px) scale(1.05); }
    }

    header{
      max-width:1200px;
      margin:0 auto;
      padding:16px 18px 10px;
    }
    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:12px;
      flex-wrap:wrap;
    }
    h1{ margin:0; font-size:22px; letter-spacing:.2px; }
    .sub{
      margin:8px 0 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.45;
    }

    .hud{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      background: var(--glass);
      border: 1px solid var(--line);
      backdrop-filter: blur(10px);
      border-radius: 999px;
      padding: 8px 12px;
      box-shadow: 0 12px 24px rgba(2,6,23,.12);
      font-size: 13px;
      color: var(--muted);
      display:flex;
      gap:10px;
      align-items:center;
      white-space:nowrap;
    }
    .pill strong{ color:var(--ink); }

    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:0 18px 26px;
    }
    .layout{
      display:grid;
      grid-template-columns: 1.08fr 1.92fr;
      gap:14px;
      align-items:start;
    }

    .panel{
      background: var(--glass);
      border: 1px solid var(--line);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .panelHd{
      padding: 12px 14px;
      border-bottom: 1px solid var(--line);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .panelHd .title{
      font-weight:900;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .badge{
      font-size:12px;
      padding: 4px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      background: var(--glass2);
      color: var(--muted);
    }
    .meta{
      margin-top:4px;
      font-size:13px;
      color:var(--muted);
    }
    .panelBd{ padding:14px; }

    .btnRow{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    button{
      border:1px solid var(--line);
      background: rgba(255,255,255,.88);
      color: var(--ink);
      padding: 10px 12px;
      border-radius: 14px;
      font-size:14px;
      cursor:pointer;
      transition: transform .08s ease, box-shadow .12s ease, filter .12s ease;
      box-shadow: 0 12px 20px rgba(2,6,23,.10);
    }
    button:hover{ transform: translateY(-1px); filter:saturate(1.06); }
    button:active{ transform: translateY(0) scale(.99); }
    button.primary{
      background: linear-gradient(135deg, var(--blue), var(--purple), var(--pink));
      color: #fff;
      border-color: transparent;
    }
    button.ghost{ background: rgba(255,255,255,.68); }
    button:disabled{
      opacity:.55; cursor:not-allowed; transform:none; box-shadow:none;
    }

    .imgWrap{
      height: 360px;
      border-radius: 18px;
      border: 1px solid var(--line);
      background: linear-gradient(180deg, #ffffff, #f8fafc);
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      overflow:hidden;
    }
    .shine{
      position:absolute; inset:-120px;
      background:
        radial-gradient(300px 240px at 28% 28%, rgba(59,130,246,.22), transparent 60%),
        radial-gradient(300px 240px at 72% 38%, rgba(236,72,153,.18), transparent 60%),
        radial-gradient(300px 240px at 45% 78%, rgba(245,158,11,.16), transparent 60%);
      pointer-events:none;
      animation: glow 3.4s ease-in-out infinite;
    }
    @keyframes glow{
      0%,100%{ transform: scale(1) rotate(0deg); opacity:.92; }
      50%{ transform: scale(1.04) rotate(3deg); opacity:1; }
    }
    #shapeImg{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
      position:relative;
      z-index:1;
      transform-origin:center;
      animation: popIn 380ms ease-out;
    }
    @keyframes popIn{
      from{ transform: scale(.92); opacity:.3; }
      to{ transform: scale(1); opacity:1; }
    }
    .pulse{ animation: pulse 1s ease-in-out infinite; }
    @keyframes pulse{
      0%,100%{ transform: scale(1); }
      50%{ transform: scale(1.02); }
    }

    .status{
      margin-top:10px;
      padding:10px 12px;
      border-radius: 16px;
      border:1px dashed rgba(15,23,42,.16);
      background: rgba(255,255,255,.72);
      color: var(--muted);
      font-size:14px;
      line-height:1.45;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .status.good{
      border-color: rgba(34,197,94,.35);
      background: rgba(34,197,94,.12);
      color: #0f5f2b;
    }
    .status.bad{
      border-color: rgba(239,68,68,.35);
      background: rgba(239,68,68,.10);
      color: #7f1d1d;
    }
    .status .dot{
      width:10px; height:10px; border-radius:999px;
      background: rgba(100,116,139,.55);
      flex: 0 0 auto;
    }
    .status.good .dot{ background: rgba(34,197,94,.9); }
    .status.bad  .dot{ background: rgba(239,68,68,.9); }

    .grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:12px;
    }
    .group{
      border-radius: 18px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.80);
      box-shadow: var(--cardShadow);
      padding:12px;
      position:relative;
      overflow:hidden;
    }
    .group::before{
      content:"";
      position:absolute; inset:-80px;
      background:
        radial-gradient(200px 160px at 25% 25%, rgba(59,130,246,.10), transparent 60%),
        radial-gradient(200px 160px at 75% 35%, rgba(236,72,153,.08), transparent 60%),
        radial-gradient(200px 160px at 45% 78%, rgba(34,197,94,.08), transparent 60%);
      pointer-events:none;
    }
    .group h3{
      margin:0 0 10px;
      font-size:14px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      position:relative;
      z-index:1;
    }
    .tag{
      font-size:12px;
      padding: 4px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.72);
      color: var(--muted);
      position:relative;
      z-index:1;
    }

    .opts{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      position:relative;
      z-index:1;
    }
    .opt{
      padding: 10px 10px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.96), rgba(248,250,252,.96));
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, box-shadow .12s ease, border-color .12s ease;
      box-shadow: 0 12px 18px rgba(2,6,23,.10);
      font-size:14px;
    }
    .opt:hover{ transform: translateY(-1px); }
    .opt.selected{
      border-color: rgba(37,99,235,.62);
      outline: 2px solid rgba(37,99,235,.23);
      background: linear-gradient(135deg, rgba(59,130,246,.18), rgba(124,58,237,.12), rgba(236,72,153,.10));
    }

    .footer{
      padding: 12px 14px;
      border-top: 1px solid var(--line);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      color: var(--muted);
      font-size: 13px;
      flex-wrap:wrap;
    }

    .bar{
      height:10px;
      width: 190px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.65);
      overflow:hidden;
      box-shadow: 0 10px 18px rgba(2,6,23,.10);
    }
    .fill{
      height:100%;
      width:100%;
      background: linear-gradient(90deg, var(--green), var(--amber), var(--red));
      transform-origin:left;
      transform: scaleX(1);
      transition: transform 200ms linear;
    }

    .fx{
      position:absolute; inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index:2;
    }
    .conf{
      position:absolute;
      width:10px; height:14px;
      border-radius: 3px;
      opacity:.95;
      animation: fall 1100ms ease-out forwards;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.12));
    }
    @keyframes fall{
      0%{ transform: translateY(-30px) rotate(0deg); opacity:0; }
      15%{ opacity:1; }
      100%{ transform: translateY(420px) rotate(260deg); opacity:0; }
    }

    .shake{ animation: shake 320ms ease-in-out; }
    @keyframes shake{
      0%{ transform: translateX(0); }
      25%{ transform: translateX(-6px); }
      50%{ transform: translateX(6px); }
      75%{ transform: translateX(-4px); }
      100%{ transform: translateX(0); }
    }

    @media(max-width:980px){
      .layout{ grid-template-columns: 1fr; }
      .imgWrap{ height: 320px; }
      .bar{ width: 160px; }
    }
  </style>
</head>

<body>
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <div class="blob b3"></div>

  <header>
    <div class="topbar">
      <div>
        <h1>ğŸ® ç«‹é«”åœ–å½¢é…å°å¤§æŒ‘æˆ°</h1>
        <div class="sub">å››é¡éƒ½è¦é…å°æ­£ç¢ºå…ˆé€šé—œï¼šA è§’æŸ±/è§’éŒï½œB å´é¢å½¢ç‹€ï½œC é¢æ•¸ï½œD åå­—ã€‚é€šé—œè‡ªå‹•ä¸‹ä¸€é¡Œï¼</div>
      </div>

      <div class="hud">
        <div class="pill">ğŸ”¥ é€£å‹ <strong id="streak">0</strong></div>
        <div class="pill">âœ… é€šé—œ <strong id="cleared">0</strong></div>
        <div class="pill">ğŸ¯ é¡Œç›® <strong id="total">0</strong></div>

        <div class="pill" title="å€’æ•¸è¨ˆæ™‚">
          â³
          <div class="bar"><div class="fill" id="fill"></div></div>
          <strong id="sec">60</strong>s
        </div>

        <button class="ghost" id="btnSound" title="éŸ³æ•ˆé–‹é—œ">ğŸ”Š éŸ³æ•ˆï¼šé–‹</button>
      </div>
    </div>
  </header>

  <div class="wrap">
    <div class="layout">

      <!-- å·¦ï¼šåœ–ç‰‡ -->
      <div class="panel" id="leftPanel">
        <div class="panelHd">
          <div>
            <div class="title">ğŸ§© æœ¬é¡Œåœ–å½¢ <span class="badge" id="meta">è§€å¯Ÿå·¦åœ–</span></div>
            <div class="meta" id="meta2">é…å°å³é‚Šå››é¡å­—å¡ã€‚</div>
          </div>
          <div class="btnRow">
            <button id="btnNew">è·³é</button>
            <button id="btnReset">é‡è¨­</button>
          </div>
        </div>

        <div class="panelBd">
          <div class="imgWrap pulse">
            <div class="shine"></div>
            <img id="shapeImg" alt="ç«‹é«”åœ–å½¢" />
            <div class="fx" id="fx"></div>
          </div>

          <div class="status" id="status">
            <span class="dot"></span>
            <span>æç¤ºï¼šå››é¡éƒ½è¦æ€å…ˆå¯ä»¥æäº¤ã€‚</span>
          </div>
        </div>
      </div>

      <!-- å³ï¼šé…å° -->
      <div class="panel" id="rightPanel">
        <div class="panelHd">
          <div class="title">ğŸƒ é¸å­—å¡é…å°</div>
          <div class="btnRow">
            <button class="primary" id="btnSubmit" disabled>æäº¤ âœ…</button>
          </div>
        </div>

        <div class="panelBd">
          <div class="grid">
            <div class="group">
              <h3>A é¡ <span class="tag">è§’æŸ± / è§’éŒ</span></h3>
              <div class="opts" id="A"></div>
            </div>

            <div class="group">
              <h3>B é¡ <span class="tag">å´é¢å½¢ç‹€</span></h3>
              <div class="opts" id="B"></div>
            </div>

            <div class="group">
              <h3>C é¡ <span class="tag">ç¸½é¢æ•¸</span></h3>
              <div class="opts" id="C"></div>
            </div>

            <div class="group">
              <h3>D é¡ <span class="tag">åå­—</span></h3>
              <div class="opts" id="D"></div>
            </div>
          </div>
        </div>

        <div class="footer">
          <div id="hint">å››é¡éƒ½è¦æ€å…ˆå¯æäº¤</div>
          <div>âœ… é€šé—œå¾Œè‡ªå‹•ä¸‹ä¸€é¡Œï½œâ³ æ™‚é–“åˆ°æœƒè‡ªå‹•è·³é¡Œ</div>
        </div>
      </div>

    </div>
  </div>

<script>
/* =========================================================
   âœ… åªæ”¹å‘¢è¡Œå°±å¯åˆ‡æ› SVG / PNG
   - ç”¨ SVGï¼š "svg"
   - ç”¨ PNGï¼š "png"
========================================================= */
const IMAGE_EXT = "svg"; // â† æ”¹æˆ "png" å°±ç”¨ PNG

/* ========= å›ºå®š 6 å€‹é¡Œåº« ========= */
const SHAPES = [
  { n:3, t:"pyramid", name:"ä¸‰è§’éŒ" },
  { n:4, t:"pyramid", name:"å››è§’éŒ" },
  { n:5, t:"pyramid", name:"äº”è§’éŒ" },
  { n:3, t:"prism",   name:"ä¸‰è§’æŸ±" },
  { n:4, t:"prism",   name:"å››è§’æŸ±" },
  { n:5, t:"prism",   name:"äº”è§’æŸ±" },
];

function facesCount(n,t){ return (t==="pyramid") ? (n+1) : (n+2); }
function imgPath(n,t){ return `${t}${n}.${IMAGE_EXT}`; } // åŒä¸€å±¤

/* ========= DOM ========= */
const el = {
  img: document.getElementById("shapeImg"),
  meta: document.getElementById("meta"),
  meta2: document.getElementById("meta2"),
  status: document.getElementById("status"),
  A: document.getElementById("A"),
  B: document.getElementById("B"),
  C: document.getElementById("C"),
  D: document.getElementById("D"),
  submit: document.getElementById("btnSubmit"),
  reset: document.getElementById("btnReset"),
  next: document.getElementById("btnNew"),
  hint: document.getElementById("hint"),
  cleared: document.getElementById("cleared"),
  total: document.getElementById("total"),
  streak: document.getElementById("streak"),
  fx: document.getElementById("fx"),
  leftPanel: document.getElementById("leftPanel"),
  fill: document.getElementById("fill"),
  sec: document.getElementById("sec"),
  btnSound: document.getElementById("btnSound"),
};

/* ========= éŸ³æ•ˆï¼ˆç°¡å–® beepï¼Œç„¡éœ€å¤–éƒ¨æª”ï¼‰ ========= */
let soundOn = true;
let audioCtx = null;

function beep(freq=660, ms=90, type="sine", gain=0.06){
  if(!soundOn) return;
  try{
    audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type;
    o.frequency.value = freq;
    g.gain.value = gain;
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    setTimeout(()=>{ o.stop(); }, ms);
  }catch(e){}
}
function sfxWin(){
  beep(784, 90, "sine", .06);
  setTimeout(()=>beep(988, 100, "sine", .06), 110);
  setTimeout(()=>beep(1175, 120, "sine", .06), 240);
}
function sfxWrong(){
  beep(220, 120, "square", .05);
  setTimeout(()=>beep(180, 130, "square", .05), 150);
}
function sfxTick(){ beep(880, 50, "sine", .03); }

/* ========= ç‹€æ…‹ ========= */
let current = null;
let pick = {A:null,B:null,C:null,D:null};
let cleared = 0;
let total = 0;
let streak = 0;
let autoTimer = null;

/* Countdownï¼šâœ… 60 ç§’ */
let timeMax = 60;
let timeLeft = timeMax;
let intervalId = null;

/* ========= å·¥å…· ========= */
function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}
function pickOne(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

function setStatus(kind, text){
  el.status.className = "status" + (kind ? (" " + kind) : "");
  el.status.querySelector("span:last-child").textContent = text;
}

function clearAuto(){
  if(autoTimer){ clearTimeout(autoTimer); autoTimer = null; }
}

/* ========= ç‰¹æ•ˆ ========= */
function confetti(){
  const colors = ["#2563eb","#7c3aed","#ec4899","#22c55e","#f59e0b","#06b6d4","#ef4444"];
  for(let i=0;i<28;i++){
    const c = document.createElement("div");
    c.className = "conf";
    c.style.left = (5 + Math.random()*90) + "%";
    c.style.top = (-20 - Math.random()*40) + "px";
    c.style.background = colors[Math.floor(Math.random()*colors.length)];
    c.style.transform = `rotate(${Math.random()*180}deg)`;
    c.style.animationDuration = (900 + Math.random()*650) + "ms";
    el.fx.appendChild(c);
    setTimeout(()=>c.remove(), 1600);
  }
}
function shake(){
  el.leftPanel.classList.remove("shake");
  void el.leftPanel.offsetWidth;
  el.leftPanel.classList.add("shake");
}

/* ========= å¡ç‰‡ ========= */
function resetPick(){
  pick = {A:null,B:null,C:null,D:null};
  document.querySelectorAll(".opt").forEach(o=>o.classList.remove("selected"));
  el.submit.disabled = true;
  el.hint.textContent = "å››é¡éƒ½è¦æ€å…ˆå¯æäº¤";
  el.meta.textContent = "è§€å¯Ÿå·¦åœ–";
  el.meta2.textContent = "é…å°å³é‚Šå››é¡å­—å¡ã€‚";
  setStatus("", "æç¤ºï¼šå››é¡éƒ½è¦æ€å…ˆå¯ä»¥æäº¤ã€‚");
}

function makeOpt(groupKey, text){
  const d = document.createElement("div");
  d.className = "opt";
  d.textContent = text;
  d.onclick = ()=>{
    pick[groupKey] = text;
    const groupEl = el[groupKey];
    [...groupEl.children].forEach(c=>c.classList.toggle("selected", c === d));
    const ok = pick.A && pick.B && pick.C && pick.D;
    el.submit.disabled = !ok;
    el.hint.textContent = ok ? "å·²é¸å››é¡ï¼Œå¯ä»¥æäº¤ âœ…" : "å››é¡éƒ½è¦æ€å…ˆå¯æäº¤";
    if(ok) beep(660, 60, "sine", .03);
  };
  return d;
}

function buildCards(){
  el.A.innerHTML = el.B.innerHTML = el.C.innerHTML = el.D.innerHTML = "";
  resetPick();

  const {n,t,name} = current;

  // æ­£ç¢ºç­”æ¡ˆï¼ˆå›ºå®šå­—ä¸²ï¼‰
  current.ans = {
    A: (t==="prism") ? "è§’æŸ±" : "è§’éŒ",
    B: (t==="prism") ? "å´é¢æ˜¯å››é‚Šå½¢" : "å´é¢æ˜¯ä¸‰è§’å½¢",
    C: `ç¸½å…±æœ‰ï¼ˆ${facesCount(n,t)}ï¼‰å€‹é¢`,
    D: `åå­—æ˜¯ï¼ˆ${name}ï¼‰`,
  };

  // A
  shuffle(["è§’æŸ±","è§’éŒ"]).forEach(v=> el.A.appendChild(makeOpt("A", v)));

  // B
  shuffle(["å´é¢æ˜¯ä¸‰è§’å½¢","å´é¢æ˜¯å››é‚Šå½¢"]).forEach(v=> el.B.appendChild(makeOpt("B", v)));

  // Cï¼šæ­£ç¢º + 2 å¹²æ“¾ï¼ˆå”¯ä¸€ï¼‰
  const correctFaces = facesCount(n,t);
  const faceSet = new Set([correctFaces]);
  while(faceSet.size < 3){
    const s = pickOne(SHAPES);
    faceSet.add(facesCount(s.n, s.t));
  }
  shuffle([...faceSet].map(v=>`ç¸½å…±æœ‰ï¼ˆ${v}ï¼‰å€‹é¢`))
    .forEach(v=> el.C.appendChild(makeOpt("C", v)));

  // Dï¼šâœ… å¿…å«æ­£ç¢ºï¼ˆå¾ 6 å€‹å›ºå®šåå­—æŠ½ï¼‰
  const namesAll = SHAPES.map(s=>s.name);
  const rest = namesAll.filter(x => x !== name);
  const dOpts = shuffle(rest).slice(0,3);
  dOpts.push(name);
  shuffle(dOpts.map(v=>`åå­—æ˜¯ï¼ˆ${v}ï¼‰`))
    .forEach(v=> el.D.appendChild(makeOpt("D", v)));
}

/* ========= åœ–ç‰‡ ========= */
function loadImage(n,t){
  el.img.style.animation = "none";
  void el.img.offsetWidth;
  el.img.style.animation = "";

  el.img.src = imgPath(n,t);
  el.img.onerror = ()=>{
    setStatus("bad", `åœ–ç‰‡è¼‰å…¥å¤±æ•—ï¼šè«‹ç¢ºèª ${imgPath(3,"pyramid")}ã€${imgPath(4,"prism")} ç­‰æª”æ¡ˆèˆ‡ index.html æ”¾åŒä¸€å±¤ï¼Œä¸¦å·² commitã€‚`);
  };
}

/* ========= å€’æ•¸è¨ˆæ™‚ ========= */
function stopTimer(){
  if(intervalId){ clearInterval(intervalId); intervalId = null; }
}
function startTimer(){
  stopTimer();
  timeLeft = timeMax;
  el.sec.textContent = String(timeLeft);
  el.fill.style.transform = "scaleX(1)";

  intervalId = setInterval(()=>{
    timeLeft -= 1;
    el.sec.textContent = String(timeLeft);
    el.fill.style.transform = `scaleX(${Math.max(0, timeLeft/timeMax)})`;

    // æœ€å¾Œ 5 ç§’æç¤ºéŸ³
    if(timeLeft <= 5 && timeLeft > 0) sfxTick();

    if(timeLeft <= 0){
      stopTimer();
      streak = 0;
      el.streak.textContent = String(streak);
      setStatus("bad", "â° æ™‚é–“åˆ°ï¼è‡ªå‹•è·³åˆ°ä¸‹ä¸€é¡Œï½");
      shake();
      sfxWrong();
      clearAuto();
      autoTimer = setTimeout(()=> newQuestion(), 900);
    }
  }, 1000);
}

/* ========= å‡ºé¡Œ ========= */
function newQuestion(){
  clearAuto();
  current = JSON.parse(JSON.stringify(pickOne(SHAPES)));

  total += 1;
  el.total.textContent = String(total);

  loadImage(current.n, current.t);
  buildCards();
  startTimer();
}

/* ========= æäº¤ ========= */
function submit(){
  const ans = current.ans;
  const wrong = [];
  if(pick.A !== ans.A) wrong.push("A");
  if(pick.B !== ans.B) wrong.push("B");
  if(pick.C !== ans.C) wrong.push("C");
  if(pick.D !== ans.D) wrong.push("D");

  if(wrong.length === 0){
    stopTimer();
    cleared += 1;
    streak += 1;
    el.cleared.textContent = String(cleared);
    el.streak.textContent = String(streak);

    setStatus("good", `ğŸ‰ é€šé—œæˆåŠŸï¼é€£å‹ +1ï¼ˆ${streak}ï¼‰ï½œ1 ç§’å¾Œä¸‹ä¸€é¡Œâ€¦`);
    el.meta.textContent = "é€šé—œï¼";
    el.meta2.textContent = `æœ¬é—œåœ–å½¢ï¼š${current.name}`;

    confetti();
    sfxWin();

    clearAuto();
    autoTimer = setTimeout(()=> newQuestion(), 1000);
  }else{
    streak = 0;
    el.streak.textContent = String(streak);
    setStatus("bad", `æœªé€šé—œï¼š${wrong.join("ã€")} é¡æœªé…å°æ­£ç¢ºï¼Œå†è©¦ä¸€æ¬¡ï¼`);
    shake();
    sfxWrong();
  }
}

/* ========= äº‹ä»¶ ========= */
el.submit.addEventListener("click", submit);
el.reset.addEventListener("click", () => { resetPick(); });
el.next.addEventListener("click", () => {
  stopTimer();
  setStatus("", "å·²è·³éï¼Œä¸‹ä¸€é¡Œï½");
  streak = 0;
  el.streak.textContent = String(streak);
  newQuestion();
});
el.btnSound.addEventListener("click", ()=>{
  soundOn = !soundOn;
  el.btnSound.textContent = soundOn ? "ğŸ”Š éŸ³æ•ˆï¼šé–‹" : "ğŸ”‡ éŸ³æ•ˆï¼šé—œ";
  if(soundOn) beep(740, 80, "sine", .05);
});

/* ========= é–‹å§‹ ========= */
newQuestion();
</script>
</body>
</html>
