<!doctype html>
<html lang="zh-HK">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ® ç«‹é«”åœ–å½¢é…å°å¤§æŒ‘æˆ°</title>

  <style>
    body{
      margin:0;
      font-family:"Noto Sans TC","PingFang TC","Microsoft JhengHei",system-ui,sans-serif;
      background:#f1f5f9;
    }
    h1{margin:12px 0;text-align:center;}
    .wrap{max-width:1100px;margin:auto;padding:12px;}
    .layout{display:grid;grid-template-columns:1fr 1.6fr;gap:16px;}
    .panel{background:#fff;border-radius:14px;padding:12px;box-shadow:0 8px 20px rgba(0,0,0,.1);}
    .imgWrap{height:320px;display:flex;align-items:center;justify-content:center;}
    img{max-width:100%;max-height:100%;}
    .groups{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    .group{border:1px solid #cbd5f5;border-radius:12px;padding:8px;}
    .opts{display:flex;flex-wrap:wrap;gap:8px;}
    .opt{
      padding:8px 10px;
      border-radius:10px;
      border:1px solid #94a3b8;
      cursor:pointer;
      background:#f8fafc;
    }
    .opt.selected{background:#c7d2fe;border-color:#4338ca;}
    button{margin-top:10px;padding:8px 14px;border-radius:10px;border:none;background:#4f46e5;color:#fff;cursor:pointer;}
    button:disabled{opacity:.5;}
    .status{margin-top:8px;}
  </style>
</head>

<body>
<h1>ğŸ® ç«‹é«”åœ–å½¢é…å°å¤§æŒ‘æˆ°</h1>

<div class="wrap">
  <div class="layout">
    <div class="panel">
      <div class="imgWrap">
        <img id="shapeImg">
      </div>
      <div class="status" id="status">è«‹å®Œæˆå³é‚Šé…å°</div>
    </div>

    <div class="panel">
      <div class="groups">
        <div class="group"><b>A é¡ï¼šè§’æŸ± / è§’éŒ</b><div id="A" class="opts"></div></div>
        <div class="group"><b>B é¡ï¼šå´é¢å½¢ç‹€</b><div id="B" class="opts"></div></div>
        <div class="group"><b>C é¡ï¼šç¸½é¢æ•¸</b><div id="C" class="opts"></div></div>
        <div class="group"><b>D é¡ï¼šåå­—</b><div id="D" class="opts"></div></div>
      </div>
      <button id="submit" disabled>æäº¤</button>
    </div>
  </div>
</div>

<script>
/* ===== åŸºæœ¬è¨­å®š ===== */
const IMAGE_EXT = "png";
const ZH = {3:"ä¸‰",4:"å››",5:"äº”",6:"å…­",7:"ä¸ƒ",8:"å…«"};
const TYPES = ["pyramid","prism"];
const TYPE_NAME = {pyramid:"è§’éŒ",prism:"è§’æŸ±"};

function facesCount(n,t){return t==="pyramid"?n+1:n+2;}
function imgPath(n,t){return t+n+"."+IMAGE_EXT;}
function shapeName(n,t){return ZH[n]+TYPE_NAME[t];}

/* ===== é¡Œåº« ===== */
const SHAPES=[];
for(let n=3;n<=8;n++){
  for(const t of TYPES){
    SHAPES.push({n,t,name:shapeName(n,t)});
  }
}

/* ===== DOM ===== */
const el={
  img:shapeImg,
  A:A,B:B,C:C,D:D,
  status:status,
  submit:submit
};

let current=null,lastKey=null;
let pick={A:null,B:null,C:null,D:null};

/* ===== å·¥å…· ===== */
function shuffle(a){return a.sort(()=>Math.random()-.5);}
function keyOf(s){return s.t+s.n;}

function makeOpt(group,text){
  const d=document.createElement("div");
  d.className="opt";
  d.textContent=text;
  d.onclick=()=>{
    pick[group]=text;
    [...el[group].children].forEach(c=>c.classList.remove("selected"));
    d.classList.add("selected");
    el.submit.disabled=!(pick.A&&pick.B&&pick.C&&pick.D);
  };
  return d;
}

/* ===== å‡ºé¡Œï¼ˆé¿å…é€£çºŒï¼‰ ===== */
function nextShape(){
  let s;
  do{s=SHAPES[Math.floor(Math.random()*SHAPES.length)];}
  while(keyOf(s)===lastKey);
  lastKey=keyOf(s);
  return s;
}

/* ===== å»ºç«‹å­—å¡ ===== */
function build(){
  pick={A:null,B:null,C:null,D:null};
  el.submit.disabled=true;
  el.A.innerHTML=el.B.innerHTML=el.C.innerHTML=el.D.innerHTML="";

  const {n,t,name}=current;

  const ans={
    A:t==="prism"?"è§’æŸ±":"è§’éŒ",
    B:t==="prism"?"å´é¢æ˜¯å››é‚Šå½¢":"å´é¢æ˜¯ä¸‰è§’å½¢",
    C:"ç¸½å…±æœ‰ï¼ˆ"+facesCount(n,t)+"ï¼‰å€‹é¢",
    D:"åå­—æ˜¯ï¼ˆ"+name+"ï¼‰"
  };
  current.ans=ans;

  shuffle(["è§’æŸ±","è§’éŒ"]).forEach(v=>el.A.appendChild(makeOpt("A",v)));
  shuffle(["å´é¢æ˜¯ä¸‰è§’å½¢","å´é¢æ˜¯å››é‚Šå½¢"]).forEach(v=>el.B.appendChild(makeOpt("B",v)));

  /* âœ… Cï¼š1 æ­£ç¢º + 3 å¹²æ“¾ */
  const correct=facesCount(n,t);
  const all=[...new Set(SHAPES.map(s=>facesCount(s.n,s.t)))];
  const distract=shuffle(all.filter(v=>v!==correct)).slice(0,3);
  shuffle([correct,...distract])
    .forEach(v=>el.C.appendChild(makeOpt("C","ç¸½å…±æœ‰ï¼ˆ"+v+"ï¼‰å€‹é¢")));

  /* Dï¼šæ­£ç¢º + 3 å¹²æ“¾ */
  const names=SHAPES.map(s=>s.name).filter(x=>x!==name);
  shuffle(names).slice(0,3).concat(name)
    .sort(()=>Math.random()-.5)
    .forEach(v=>el.D.appendChild(makeOpt("D","åå­—æ˜¯ï¼ˆ"+v+"ï¼‰")));
}

/* ===== æ–°é¡Œ ===== */
function newQ(){
  current=nextShape();
  el.img.src=imgPath(current.n,current.t);
  build();
}

/* ===== æäº¤ ===== */
el.submit.onclick=()=>{
  const w=[];
  for(const k in pick) if(pick[k]!==current.ans[k]) w.push(k);
  if(w.length===0){
    el.status.textContent="ğŸ‰ æ­£ç¢ºï¼è‡ªå‹•ä¸‹ä¸€é¡Œ";
    setTimeout(newQ,800);
  }else{
    el.status.textContent="âŒ "+w.join("ã€")+" é¡éŒ¯èª¤";
  }
};

newQ();
</script>
</body>
</html>
